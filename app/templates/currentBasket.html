{% extends 'base.html' %}

{% block title %}Basket - The Divine Jewelry{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/basketStyle.css') }}">

<<<<<<< Updated upstream
<div class="cart">
    <a href="#" id="cart-link">My Cart (0 Items)</a>
</div>
=======
  <div class="cart">
    <a href="Payment.html" id="cart-link">My Cart (0 Items)</a>
  </div>
>>>>>>> Stashed changes

<main class="basket-page">
    <section class="recommended-section">
        <h2 class="section-title">Recommended Products</h2>
        <div class="product-grid">
            <div class="product-card">
                <img src="{{ url_for('static', filename='images/leaf_ring_1.webp') }}" alt="Elegant leaf design">
                <div class="product-info">
                    <h3>Elegant leaf design</h3>
                    <p class="product-price">£150.00</p>
                    <button class="btn-primary add-btn" data-name="Elegant leaf design" data-price="150.00">Add to Cart</button>
                </div>
            </div>
            
            <div class="product-card">
                <img src="{{ url_for('static', filename='images/crystal_ring_1.jpg') }}" alt="Crystal ring">
                <div class="product-info">
                    <h3>Crystal ring</h3>
                    <p class="product-price">£180.00</p>
                    <button class="btn-primary add-btn" data-name="Crystal ring" data-price="180.00">Add to Cart</button>
                </div>
            </div>
            
            <div class="product-card">
                <img src="{{ url_for('static', filename='images/pearl_necklace_1.webp') }}" alt="Pearl necklace">
<<<<<<< Updated upstream
                <div class="product-info">
                    <h3>Pearl necklace</h3>
                    <p class="product-price">£250.00</p>
                    <button class="btn-primary add-btn" data-name="Pearl necklace" data-price="250.00">Add to Cart</button>
                </div>
            </div>
        </div>
    </section>

    <aside class="order-summary">
        <h2 class="section-title">Order Summary</h2>
        <ul id="order-summary-list">
            <li>Basket is empty</li>
        </ul>
        <p id="order-total"><strong>Total: £0.00</strong></p>
        <button class="btn-primary" onclick="showPromoPopup()">Enter Promo Code</button>
        <a href="{{ url_for('routes.payment') }}" class="btn-primary checkout-btn">Checkout</a>
    </aside>
=======
                <h2>Pearl necklace</h2>
                <p>£250.00</p>
                <button class="btn-primary add-btn" data-name="Pearl necklace" data-price="250.00">Add to Cart</button>
      </div>
    </div>
  </div>
>>>>>>> Stashed changes
</main>

<div id="promo-popup" class="popup hidden">
    <span id="close-popup" class="close">&times;</span>
    <h2>Enter Promo Code</h2>
    <input type="text" id="promo-code-input" placeholder="Enter code">
    <button class="btn-primary" onclick="applyPromoCode()">Apply</button>
</div>

<div id="success-popup" class="popup hidden success-message">Congratulations! 20% off!</div>
<div id="error-popup" class="popup hidden error-message">Mmm... not quite!</div>

<<<<<<< Updated upstream
<script src="{{ url_for('static', filename='js/basket.js') }}"></script>
=======
{% endblock %}

{% block scripts %}

  <script>
let cartItems = [];
let totalAmount = 0;

function addToCart(itemName, itemPrice, itemImage) {
  const existingItemIndex = cartItems.findIndex((item) => item.name === itemName);
  if (existingItemIndex !== -1) {
    cartItems[existingItemIndex].quantity += 1;
  } else {
    cartItems.push({ name: itemName, price: itemPrice, image: itemImage, quantity: 1 });
  }
  totalAmount += itemPrice;
  updateCart();
  updateOrderSummary();
}

function updateCart() {
  document.getElementById("cart-link").innerText = `My Cart (${cartItems.length} Items)`;
}

function updateOrderSummary() {
  const orderSummaryList = document.getElementById("order-summary-list");
  const orderTotal = document.getElementById("order-total");

  orderSummaryList.innerHTML = cartItems.length ? "" : "<li>Basket is empty</li>";

  cartItems.forEach((item, index) => {
    const listItem = document.createElement("li");
    listItem.innerHTML = `
      <img src="${item.image}" alt="${item.name}" class="basket-item-img">
      <span>${item.name} - £${(item.price * item.quantity).toFixed(2)}</span>
      <div class="quantity-controls">
        <button onclick="decreaseQuantity(${index})">-</button>
        <span class="item-quantity">${item.quantity}</span>
        <button onclick="increaseQuantity(${index})">+</button>
      </div>`;
    orderSummaryList.appendChild(listItem);
  });

  orderTotal.innerHTML = `<strong>Total: £${totalAmount.toFixed(2)}</strong>`;
}

function increaseQuantity(index) {
  cartItems[index].quantity += 1;
  totalAmount += cartItems[index].price;
  updateOrderSummary();
}

function decreaseQuantity(index) {
  if (cartItems[index].quantity > 1) {
    cartItems[index].quantity -= 1;
    totalAmount -= cartItems[index].price;
  } else {
    totalAmount -= cartItems[index].price;
    cartItems.splice(index, 1);
  }
  updateOrderSummary();
}

function removeFromCart(index) {
  totalAmount -= cartItems[index].price * cartItems[index].quantity;
  cartItems.splice(index, 1);
  updateCart();
  updateOrderSummary();
}

function showPromoPopup() {
  document.getElementById("promo-popup").classList.remove("hidden");
}

function closePopup() {
  document.getElementById("promo-popup").classList.add("hidden");
}

function applyPromoCode() {
  const code = document.getElementById("promo-code-input").value;
  if (code === "TEAM20") {
    showMessage("success-popup");
    totalAmount *= 0.8;
    updateOrderSummary();
  } else {
    showMessage("error-popup");
  }
}

function showMessage(popupId) {
  const popup = document.getElementById(popupId);
  popup.classList.remove("hidden");
  setTimeout(() => {
    popup.classList.add("hidden");
  }, 6000);
}

document.getElementById("close-popup").addEventListener("click", closePopup);

document.querySelectorAll(".add-btn").forEach((btn) =>
  btn.addEventListener("click", (event) => {
    const name = event.target.dataset.name;
    const price = parseFloat(event.target.dataset.price);
    const image = event.target.closest(".product-details").querySelector("img").src;
    addToCart(name, price, image);
  })
);
  </script>
</body>
</html>
>>>>>>> Stashed changes
{% endblock %}